pipeline {
    agent any

    environment {
        DOCKERHUB_USER = credentials("dockerhub-credentials")
        IMAGE = "tejaswi4268/myproject"
        TAG = "latest"
    }
    

    stages {
        stage ("checkout scm") {
            steps {
                git "https://github.com/tejaswi-teju/myproject.git"
            }
        }

        stage ("Build Dockerfile") {
            steps {
                sh "docker build -t myapp:latest ./terraform.tf"
            }
        }

        stage ("Push to Dockerhub") {
            steps {
                #docker login -u $DOCKERHUB_USR -p $DOCKERHUB_PSW # this cmd uses interative terminal which is not possible in jenkins
                sh '''
                docker tag myapp:latest $IMAGE:$TAG
                echo "$DOCKERHUB_PSW" | docker login -u "$DOCKERHUB_USR" --password-stdin
                docker push $IMAGE:$TAG
                '''
            }
        }

        /*stage ("Push Image to AWS ECR") {
            steps {
                sh ""
            }
        }*/
    }
}